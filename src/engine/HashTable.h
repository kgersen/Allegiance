#pragma once

#include <cstdint>

////////////////////////////////////////////////////////////////////////////////////////////////////
// CHashEntry()
// Base class, to be derived from.
////////////////////////////////////////////////////////////////////////////////////////////////////
class CHashEntry
{
////////////////////////////////////////////////////////////////////////////////////////////////////
protected:
    uint32_t			m_dwHashValue;
	CHashEntry *	m_pNextHashEntry;				// Next hash entry in list.

////////////////////////////////////////////////////////////////////////////////////////////////////
public:
    CHashEntry( uint32_t dwHashValue, void * pObject )
	{
		m_dwHashValue = dwHashValue;
		m_pNextHashEntry = NULL;
	}

	virtual ~CHashEntry(void)
	{
	}

    inline uint32_t GetHashValue()					{	return m_dwHashValue;		}
    inline void SetHashValue( uint32_t dwHash )	{	m_dwHashValue = dwHash;		}
	inline CHashEntry * GetNext()				{	return m_pNextHashEntry;	}
	inline void SetNext( CHashEntry * pNext )	{	m_pNextHashEntry = pNext;	}
};



////////////////////////////////////////////////////////////////////////////////////////////////////
class CHashTable
{
////////////////////////////////////////////////////////////////////////////////////////////////////
public:
	static const int s_iDefaultTableSize = 503;		// Prime number.

////////////////////////////////////////////////////////////////////////////////////////////////////
private:
    uint32_t m_dwTableSize;
    uint32_t m_dwTotalEntriesAdded;
	CHashEntry ** m_ppHashTable;
	bool m_bValidateEntries;			// If true, check all entries for a hash value clash.

////////////////////////////////////////////////////////////////////////////////////////////////////
public:
	////////////////////////////////////////////////////////////////////////////////////////////
    CHashTable( uint32_t dwTableSize = uint32_t(s_iDefaultTableSize), bool bValidateEntries = false );
	~CHashTable(void);

	////////////////////////////////////////////////////////////////////////////////////////////
	// Add the hash entry to the hash table. If a match is already found, a pointer is returned
	// to it, otherwise NULL.
	CHashEntry * AddHashEntry( CHashEntry * pHashEntry );

	////////////////////////////////////////////////////////////////////////////////////////////
	// Returns a hash entry with a matching hash value, NULL if no match is found.
    CHashEntry * GetHashEntry( uint32_t dwHashSearchValue );

	////////////////////////////////////////////////////////////////////////////////////////////
    CHashEntry * GetLeadHashEntryByIndex( uint32_t dwIndex );

	////////////////////////////////////////////////////////////////////////////////////////////
    uint32_t GetTableSize() {	return m_dwTableSize;	}

	////////////////////////////////////////////////////////////////////////////////////////////
    uint32_t GetNumChildren( CHashEntry * pEntry );

	////////////////////////////////////////////////////////////////////////////////////////////
    static uint32_t GenerateHashValue( const char * szString );
};
